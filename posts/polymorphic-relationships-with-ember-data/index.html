<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <title>Brian Gonzalez | Developer</title>
    <link rel="stylesheet" href="/css/app.css">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" href="/images/favicon.png" sizes="192x192" type="image/png">
  </head>

  <body id="body" data-url="/">

    <main role="main" id="main">
        <div id="waves"></div>
      
<h2 class="main page-title">

  <span class="zag">Polymorphic Relationships with Ember Data</span>
</h2>

<div>
  <date>
    – 01/30/17
  </date>
</div>

<p><em>Note: this is a post of what might <a href="https://github.com/emberjs/guides/pull/1797" target="_blank" rel="external">eventually land</a> in the Ember documentation. Until then, enjoy.</em></p>
<p>Polymorphism is a powerful concept which allows a developer to abstract common functionality into a base class. Consider the following example: a user with multiple payment methods. They could have a linked Paypal account, and a couple credit cards on file.</p>
<p>Note that, for polymorphism to work, Ember Data expects a “type” declaration polymorphic type via the reserved <code>type</code> property on the model. Confused? See the API response below.</p>
<p>First, let’s look at the model definitions:</p>
<pre><code class="js">/* app/models/user.js */
import DS from &#39;ember-data&#39;;
let { hasMany } = DS;

export default DS.Model.extend({
  paymentMethods: hasMany(&#39;payment-method&#39;, { polymorphic: true })
});
</code></pre>
<pre><code class="js">/* app/models/payment-method.js */
import DS from &#39;ember-data&#39;;
let { belongsTo } = DS;

export default DS.Model.extend({
  user: belongsTo(&#39;user&#39;, { inverse: &#39;paymentMethods&#39; }),
});
</code></pre>
<pre><code class="js">/* app/models/payment-method-cc.js */
import PaymentMethod from &#39;./payment-method&#39;
import DS from &#39;ember-data&#39;;
import Ember from &#39;ember&#39;;
let { attr } = DS;
let { computed } = Ember;

export default DS.Model.extend({
  obfuscatedIdentifier: computed(&#39;last4&#39;, function () {
    return `**** **** **** ${this.get(&#39;last4&#39;)}`
  })
});
</code></pre>
<pre><code class="js">/* app/models/payment-method-paypal.js */
import PaymentMethod from &#39;./payment-method&#39;
import DS from &#39;ember-data&#39;;
import Ember from &#39;ember&#39;;
let { attr } = DS;
let { computed } = Ember;

export default DS.Model.extend({
  linkedEmail: attr(),
  obfuscatedIdentifier: computed(&#39;linkedEmail&#39;, function () {
    const last5 = this.get(&#39;linkedEmail&#39;)
      .split(&#39;&#39;).reverse().slice(0, 5).reverse().join(&#39;&#39;);
    return `••••${last5}`
  })
});
</code></pre>
<p>And our API might setup these relationships like so:</p>
<pre><code>&quot;data&quot;:{
   &quot;id&quot;:&quot;8675309&quot;,
   &quot;type&quot;:&quot;user&quot;,
   &quot;attributes&quot;:{
      &quot;name&quot;:&quot;Anfanie Farmeo&quot;
   },
   &quot;relationships&quot;:{
      &quot;payment-methods&quot;:{
         &quot;data&quot;:[
            { &quot;id&quot;:1, &quot;type&quot;:&quot;PaymentMethodPaypal&quot; },
            { &quot;id&quot;:2, &quot;type&quot;:&quot;PaymentMethodCc&quot; },
            { &quot;id&quot;:3, &quot;type&quot;:&quot;PaymentMethodApplePay&quot; }
         ]
      }
   }
},
&quot;included&quot;:[
   {
      &quot;id&quot;:1,
      &quot;type&quot;:&quot;PaymentMethodPaypal&quot;,
      &quot;attributes&quot;:{
         &quot;linked-email&quot;:&quot;ryan@gosling.io&quot;,
      }
   },
   {
      &quot;id&quot;:2,
      &quot;type&quot;:&quot;PaymentMethodCc&quot;,
      &quot;attributes&quot;:{
         &quot;last4&quot;:&quot;1335&quot;
      }
   },
   {
      &quot;id&quot;:3,
      &quot;type&quot;:&quot;PaymentMethodCc&quot;,
      &quot;attributes&quot;:{
         &quot;last4&quot;:&quot;5513&quot;
      }
   },
]
</code></pre><p>I’ve created a <a href="https://github.com/briangonzalez/ember-polymorphic" target="_blank" rel="external">little repo</a> to play around with.</p>


    </main>

    <div class="body-border">
    </div>

    <router-view></router-view>

    <div class="loader"></div>

    <menulink>
    </menulink>

    <menu>
    </menu>

    <a v-link="{ path: '/' }" href='/' class="logo">
      Bg
    </a>

    <div class="decoration-line"></div>

    <footer>
      <section class="main">
        <ul>
          <li><a href="/">Posts</a></li>
          <li><a href="https://github.com/briangonzalez">Github</a></li>
          <li><a href="https://twitter.com/brianmgonzalez">Twitter</a></li>
          <li><a href="/about">About</a></li>
        </ul>

        <div class="image">
        </div>
      </section>
    </footer>

    <script>
      window.updateBodyURL = function () {
        document.getElementsByTagName('body')[0]
                .setAttribute('data-url', window.location.pathname);
      }
      window.updateBodyURL();
    </script>
    <script src="/js/app.js"> </script>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-5991707-2', 'auto');
      ga('send', 'pageview');
    </script>

  </body>
</html>
